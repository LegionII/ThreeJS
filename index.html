<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="Three.js"></script>
    <script type="text/javascript" src="physi.js"></script>
    <script type="text/javascript" src="OrbitControls.js"></script>

    <script type="text/javascript">

        'use strict';

        Physijs.scripts.worker = 'physijs_worker.js';
        Physijs.scripts.ammo = 'ammo.js';

        var initScene, render, renderer, scene, camera, box, material, ground, ground_material, controls, light;

        initScene = function () {
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('viewport').appendChild(renderer.domElement);

            scene = new Physijs.Scene;
            
            camera = new THREE.PerspectiveCamera(
                60,
                window.innerWidth / window.innerHeight,
                1,
                1000
            );
            camera.position.z = 100;
       //     camera.lookAt(scene.position);

            scene.add(camera);

            controls = new THREE.OrbitControls(camera);
            controls.addEventListener('change', render);


            // Box
            material = Physijs.createMaterial(
					new THREE.MeshLambertMaterial({ map: THREE.ImageUtils.loadTexture('plywood.jpg') }),
					.6, // medium friction
					.3 // low restitution
				);
            material.map.wrapS = material.map.wrapT = THREE.RepeatWrapping;
            material.map.repeat.set(.5, .5);

            box = new Physijs.BoxMesh(
                new THREE.CubeGeometry(5,5,5),
                material
            );

            // Light
            light = new THREE.DirectionalLight(0xFFFFFF);
            light.position.set(20, 40, -15);
            light.target.position.copy(scene.position);
            light.castShadow = true;
            light.shadowCameraLeft = -60;
            light.shadowCameraTop = -60;
            light.shadowCameraRight = 60;
            light.shadowCameraBottom = 60;
            light.shadowCameraNear = 20;
            light.shadowCameraFar = 200;
            light.shadowBias = -.0001
            light.shadowMapWidth = light.shadowMapHeight = 2048;
            light.shadowDarkness = .7;
            scene.add(light);

            // Ground
            ground_material = Physijs.createMaterial(
                new THREE.MeshLambertMaterial({ map: THREE.ImageUtils.loadTexture('rocks.jpg') }),
                .8, // high friction
                .3 // low restitution
            );
            ground_material.map.wrapS = ground_material.map.wrapT = THREE.RepeatWrapping;
            ground_material.map.repeat.set(3, 3);

            ground = new Physijs.BoxMesh(
			new THREE.CubeGeometry(100, 1, 100),
			ground_material,
			0 // mass
		    );
            ground.receiveShadow = true;
            ground.position.set(0, -20, 0);
           // ground.rotateX(-45);
            scene.add(ground);
            box.rotateX(45);
            scene.add(box);


            requestAnimationFrame(render);
        };

        render = function () {
            scene.simulate(); // run physics
            renderer.render(scene, camera); // render the scene
            requestAnimationFrame(render);
        };

        window.onload = initScene;

    </script>
</head>

<body>
    <div id="viewport"></div>
</body>
</html>